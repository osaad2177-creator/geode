<div class="card">
<img id="companyLogo" src="https://osaad2177-creator.github.io/Attendance-Zoom/assets/logo.svg" alt="Company Logo">
<h1>Attendance System</h1>

<!-- Order Name Input -->
<input type="text" id="orderName" placeholder="Enter Order Name" required>

<!-- Employee Name Input -->
<input type="text" id="employeeName" placeholder="Enter full name" required>

<button id="checkIn">✅ Check In</button>
<button id="checkOut">❌ Check Out</button>
<div id="status"></div>
</div>

<script>
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwB-MuJHOQNcFnTqd3mo5C0SMXkqbn7o_UB7VGe7_5ICfGuPRrt7LDaqO4Gj8Y7EOgyqg/exec';

async function sendAttendance(type) {
  const orderName = document.getElementById('orderName').value.trim();
  const name = document.getElementById('employeeName').value.trim();
  const status = document.getElementById('status');

  if (!orderName) { status.innerText = 'Please enter order name'; return; }
  if (!name) { status.innerText = 'Please enter your name'; return; }

  if (!navigator.geolocation) { status.innerText = 'Geolocation not supported'; return; }

  status.innerText = 'Fetching location...';

  navigator.geolocation.getCurrentPosition(async (pos) => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    try {
      const url = new URL(APPS_SCRIPT_URL);
      url.searchParams.set('order_name', orderName); // Add order name
      url.searchParams.set('employee_name', name);
      url.searchParams.set('attendance_type', type);
      url.searchParams.set('latitude', lat);
      url.searchParams.set('longitude', lng);

      const res = await fetch(url, { mode: 'cors' });
      const text = await res.text();
      if (res.ok) {
        status.innerHTML = text + `<br><a href="https://www.google.com/maps?q=${lat},${lng}" target="_blank">View location</a>`;
      } else {
        status.innerText = text || 'Error recording attendance';
      }
    } catch (err) {
      status.innerText = 'Network error. Try again.';
    }
  }, (err) => {
    status.innerText = 'Location permission denied or unavailable';
  }, { enableHighAccuracy: true, timeout: 15000 });
}

document.getElementById('checkIn').addEventListener('click', () => sendAttendance('Check In'));
document.getElementById('checkOut').addEventListener('click', () => sendAttendance('Check Out'));
</script>
