<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Attendance System</title>
<style>
body { font-family: Arial; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #f0f4f8; }
.card { background: #fff; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
h1 { text-align: center; margin-bottom: 1rem; }
input, button { width: 100%; padding: 0.75rem; margin: 0.5rem 0; border-radius: 10px; border: 1px solid #ccc; font-size: 1rem; }
button { cursor: pointer; }
#status { margin-top: 1rem; text-align: center; }
</style>
</head>
<body>
<div class="card">
<h1>Attendance System</h1>
<input type="text" id="employeeName" placeholder="Enter full name" required>
<input type="text" id="orderName" placeholder="Enter Order Name" required>
<button id="checkIn">✅ Check In</button>
<button id="checkOut">❌ Check Out</button>
<div id="status"></div>
</div>

<script>
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwWef9XSKgQBeSiCUUnNV28w02bOdZ2QlpFBz7-bUZ8NdqyDn9PH_gKx3WD1RMjQStSVA/exec';

async function sendAttendance(type) {
  const name = document.getElementById('employeeName').value.trim();
  const order = document.getElementById('orderName').value.trim();
  const status = document.getElementById('status');
  if (!name || !order) { status.innerText = 'Please enter your name and order'; return; }

  if (!navigator.geolocation) { status.innerText = 'Geolocation not supported'; return; }

  status.innerText = 'Fetching location...';

  navigator.geolocation.getCurrentPosition(async (pos) => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;
    const mapLink = `https://www.google.com/maps?q=${lat},${lng}`;

    try {
      const url = new URL(APPS_SCRIPT_URL);
      url.searchParams.set('employee_name', name);
      url.searchParams.set('order_name', order);
      url.searchParams.set('attendance_type', type);
      url.searchParams.set('map_link', mapLink);

      const res = await fetch(url, { mode: 'cors' });
      const text = await res.text();
      if (res.ok) {
        status.innerHTML = text + `<br><a href="${mapLink}" target="_blank">View location</a>`;
      } else {
        status.innerText = text || 'Error recording attendance';
      }
    } catch (err) {
      status.innerText = 'Network error. Try again.';
    }
  }, (err) => {
    status.innerText = 'Location permission denied or unavailable';
  }, { enableHighAccuracy: true, timeout: 15000 });
}

document.getElementById('checkIn').addEventListener('click', () => sendAttendance('Check In'));
document.getElementById('checkOut').addEventListener('click', () => sendAttendance('Check Out'));
</script>
</body>
</html>
